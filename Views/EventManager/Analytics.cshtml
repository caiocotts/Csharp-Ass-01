
<!DOCTYPE html>

<html lang="en">
<head>
    <title>Analytics</title>
    <link rel="stylesheet" href="/css/DarkMode.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<div>
    <h1 class="text-center">Analytics Dashboard</h1>
</div>

<div id="charts-container">
    <div class="chart" id="chart1-container">
        <canvas id="ticketSalesByCategory"></canvas>
    </div>

    <div class="chart" id="chart2-container">
        <canvas id="monthlyRevenue"></canvas>
    </div>
</div>

<script>

        // Dummy data to test
        /*const events = [
            { name: "Webinar", sold: 120 },
            { name: "Concert", sold: 95 },
            { name: "Workshop", sold: 60 },
            { name: "Conference", sold: 140 },
    ];*/
        fetch('/EventManager/GetTicketData')
            .then(res => res.json())
            .then(events => {

                const labels = events.map(e => e.name);
                const values = events.map(e => e.sold);

                const data = {
                    labels: labels,
                    datasets: [{
                        label: 'Tickets Sold',
                        data: values
                    }]
                };  
                
                //everthing above here is purely for the data

                const config = {
                    type: 'polarArea',
                    data: data,
                    options: {
                        responsive: true,

                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: 'white',
                                }
                            },
                            
                            title: {
                                display: true,
                                text: 'Ticket Sales Per Category',
                                font: {
                                    size: 30,
                                    weight: 'bold',
                                },
                                color: 'white'

                            },
                            
                        },

                    }
                };

                const ctx = document.getElementById('ticketSalesByCategory').getContext('2d');
                new Chart(ctx, config);
           
            });
</script>

<script>
    // Fetch data from the server
    fetch('/EventManager/GetMonthlyRevenueData/')
        .then(res => res.json())
        .then(events => {
            console.log("Fetched data:", JSON.stringify(events, null, 2));

            // If the API returns empty or fails, fallback to dummy data
            if (!events || events.length === 0) {
                events = [
                    { month: "November 2025", revenue: 120 },
                    { month: "October 2025", revenue: 95 },
                    { month: "September 2025", revenue: 60 },
                ];
            }

            const labels = events.map(e => e.month);
            const values = events.map(e => e.revenue);

            const data = {
                labels: labels,
                datasets: [{
                    label: 'Revenue',
                    data: values,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    pointStyle: 'circle',
                    pointRadius: 6,
                    pointHoverRadius: 10
                }]
            };

            const config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: 'white' } },
                        title: {
                            display: true,
                            text: 'Monthly Revenue',
                            font: { size: 24, weight: 'bold' },
                            color: 'white'
                        }
                    },
                    scales: {
                        y : {
                            ticks: {
                                color: 'white',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            ticks: {
                                color: 'white',
                            }
                        }
                    }
                }
            };

            const ctx = document.getElementById('monthlyRevenue').getContext('2d');
            new Chart(ctx, config);
        });
       

</script>



</body>
</html>

<style>
    #charts-container {
        display: flex;          
        gap: 20px;            
        justify-content: center; 
        align-items: flex-start;
    }
    .chart {
        width: 750px;
        height: 750px;
        border-radius: 10px;
        border: 1px solid white;
    }
   
</style>